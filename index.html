<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Save Notes</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: white;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: white;
            border-bottom: 1px solid #eee;
            z-index: 1002;
        }
        .menu-icon {
            width: 45px;
            height: 45px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .menu-icon:active {
            animation: rubberBand 0.6s ease-in-out;
        }
        @keyframes rubberBand {
            0% { transform: scale3d(1, 1, 1); }
            30% { transform: scale3d(1.25, 0.75, 1); }
            40% { transform: scale3d(0.75, 1.25, 1); }
            50% { transform: scale3d(1.15, 0.85, 1); }
            65% { transform: scale3d(0.95, 1.05, 1); }
            75% { transform: scale3d(1.05, 0.95, 1); }
            100% { transform: scale3d(1, 1, 1); }
        }
        .share-icon-header {
            width: 45px;
            height: 45px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .share-icon-header:active {
            animation: tada 0.6s ease-in-out;
        }
        @keyframes tada {
            0% { transform: scale3d(1, 1, 1); }
            10%, 20% { transform: scale3d(0.9, 0.9, 0.9) rotate3d(0, 0, 1, -3deg); }
            30%, 50%, 70%, 90% { transform: scale3d(1, 1, 1) rotate3d(0, 0, 1, 3deg); }
            40%, 60%, 80% { transform: scale3d(1, 1, 1) rotate3d(0, 0, 1, -3deg); }
            100% { transform: scale3d(1, 1, 1); }
        }
        .app-name-bar {
            background-color: white;
            text-align: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            z-index: 1002;
        }
        .app-name {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }
        .search-bar {
            padding: 10px;
            background-color: white;
            border-bottom: 1px solid #eee;
            z-index: 1002;
        }
        .search-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        .title-bar {
            display: none;
            padding: 10px;
            background-color: white;
            border-bottom: 1px solid #eee;
            z-index: 1002;
        }
        .editor-title-display {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 18px;
            text-align: center;
        }
        .main-content {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            position: relative;
            z-index: 1;
        }
        .editor-full {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 1001;
            flex-direction: column;
        }
        .editor-full.active {
            display: flex;
        }
        .editor-text-full {
            flex: 1;
            width: 100%;
            padding: 10px;
            border: none;
            box-sizing: border-box;
            resize: none;
            font-size: 16px;
            line-height: 1.5;
        }
        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100vh;
            background-color: white;
            border-right: 1px solid #ddd;
            transition: left 0.3s ease-in-out;
            z-index: 1001;
            padding: 20px;
            box-sizing: border-box;
        }
        .sidebar.open {
            left: 0;
        }
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .overlay.open {
            display: block;
        }
        .note-file {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .note-file:hover {
            background-color: #f9f9f9;
        }
        .note-file:active {
            animation: shake 0.5s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translate3d(0, 0, 0); }
            10%, 30%, 50%, 70%, 90% { transform: translate3d(-5px, 0, 0); }
            20%, 40%, 60%, 80% { transform: translate3d(5px, 0, 0); }
        }
        .note-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .note-title {
            font-size: 16px;
            flex: 1;
        }
        .edit-icon, .notification-icon, .delete-btn {
            width: 30px;
            height: 30px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .edit-icon:active, .notification-icon:active, .delete-btn:active {
            animation: pulse 0.5s ease-in-out;
        }
        @keyframes pulse {
            0% { transform: scale(0.9); box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(0, 0, 0, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 0, 0, 0); }
        }
        .delete-btn {
            font-size: 20px;
            color: #ff4444;
            background: none;
            border: none;
            padding: 0;
        }
        .new-tab-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 65px;
            height: 65px;
            background-color: #f0f0f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1003;
        }
        .new-tab-btn:active {
            animation: swing 0.6s ease-in-out;
        }
        @keyframes swing {
            20% { transform: rotate3d(0, 0, 1, 15deg); }
            40% { transform: rotate3d(0, 0, 1, -10deg); }
            60% { transform: rotate3d(0, 0, 1, 5deg); }
            80% { transform: rotate3d(0, 0, 1, -5deg); }
            100% { transform: rotate3d(0, 0, 1, 0deg); }
        }
        .new-tab-icon {
            width: 45px;
            height: 45px;
        }
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 10px;
            background-color: white;
            border-top: 1px solid #eee;
            position: fixed;
            bottom: 0;
            width: 100%;
            z-index: 1002;
        }
        .nav-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .nav-icon:active {
            animation: jello 0.6s ease-in-out;
        }
        @keyframes jello {
            0%, 11.1%, 100% { transform: none; }
            22.2% { transform: skewX(-12.5deg) skewY(-12.5deg); }
            33.3% { transform: skewX(6.25deg) skewY(6.25deg); }
            44.4% { transform: skewX(-3.125deg) skewY(-3.125deg); }
            55.5% { transform: skewX(1.5625deg) skewY(1.5625deg); }
            66.6% { transform: skewX(-0.78125deg) skewY(-0.78125deg); }
            77.7% { transform: skewX(0.390625deg) skewY(0.390625deg); }
            88.8% { transform: skewX(-0.1953125deg) skewY(-0.1953125deg); }
        }
        .nav-icon img {
            width: 35px;
            height: 35px;
        }
        .nav-label {
            font-size: 10px;
            margin-top: 2px;
        }
        /* Popup styles */
        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .popup-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            text-align: center;
        }
        .trash-content {
            text-align: left;
        }
        .editor-content {
            text-align: left;
        }
        .editor-title {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            font-size: 18px;
        }
        .editor-text {
            width: 100%;
            height: 300px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            resize: vertical;
        }
        .deleted-note {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .deleted-actions {
            display: flex;
            gap: 10px;
        }
        .alert-icon {
            width: 50px;
            height: 50px;
            margin-bottom: 10px;
        }
        .popup-buttons {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .btn:active {
            animation: bounce 0.6s ease-in-out;
        }
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0, -10px, 0); }
            70% { transform: translate3d(0, -4.5px, 0); }
            90% { transform: translate3d(0, -1px, 0); }
        }
        .confirm-btn {
            background-color: #ff4444;
            color: white;
        }
        .cancel-btn {
            background-color: #ccc;
            color: black;
        }
        .share-icons {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }
        .share-icon {
            width: 40px;
            height: 40px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 0 5px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .share-icon:active {
            animation: wobble 0.6s ease-in-out;
        }
        @keyframes wobble {
            0% { transform: translateX(0%); }
            15% { transform: translateX(-25%) rotate(-5deg); }
            30% { transform: translateX(20%) rotate(3deg); }
            45% { transform: translateX(-15%) rotate(-3deg); }
            60% { transform: translateX(10%) rotate(2deg); }
            75% { transform: translateX(-5%) rotate(-1deg); }
            100% { transform: translateX(0%); }
        }
        /* Onboarding guide placeholder */
        .onboarding {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 999;
        }
        .guide-step {
            position: absolute;
            background-color: white;
            padding: 10px;
            border-radius: 5px;
            max-width: 200px;
        }
        .skip-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #ccc;
            color: black;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        /* Settings submenu placeholder */
        .settings-menu {
            display: none;
            position: fixed;
            top: 50px;
            right: 10px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
        }
        .settings-item {
            display: flex;
            align-items: center;
            padding: 5px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .settings-item:active {
            animation: headShake 0.5s ease-in-out;
        }
        @keyframes headShake {
            0% { transform: translateX(0); }
            6.5% { transform: translateX(-6px) rotateY(-9deg); }
            18.5% { transform: translateX(5px) rotateY(7deg); }
            31.5% { transform: translateX(-3px) rotateY(-5deg); }
            43.5% { transform: translateX(2px) rotateY(3deg); }
            50% { transform: translateX(0); }
        }
        .settings-item img {
            width: 30px;
            height: 30px;
            margin-right: 10px;
        }
        .no-notes {
            text-align: center;
            color: #666;
            font-size: 16px;
            margin-top: 50px;
        }
        .no-deleted {
            text-align: center;
            color: #666;
            font-size: 16px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- Overlay for sidebar -->
    <div class="overlay" id="overlay" onclick="closeSidebar()"></div>

    <!-- Sidebar Menu -->
    <div class="sidebar" id="sidebar">
        <h3>Deleted Notes</h3>
        <div id="trashContent">
            <div class="no-deleted">No deleted notes.</div>
        </div>
        <div class="popup-buttons">
            <button class="btn cancel-btn" onclick="closeSidebar()">Close</button>
        </div>
    </div>

    <!-- Header -->
    <div class="header">
        <img src="https://i.postimg.cc/MTXktVNT/1758009527072.png" alt="Menu" class="menu-icon" id="menuIcon" onclick="openSidebar()">
        <div> </div> <!-- Spacer -->
        <img src="https://i.postimg.cc/rsNdR41F/share-icon-on-transparent-background-free-png.png" alt="Share" class="share-icon-header" onclick="openInvite()">
    </div>

    <!-- App Name Bar -->
    <div class="app-name-bar">
        <div class="app-name">Save Notes</div>
    </div>

    <!-- Title Bar for Editor -->
    <div class="title-bar" id="titleBar">
        <input type="text" id="editorTitle" class="editor-title-display" placeholder="Note Title">
    </div>

    <!-- Search Bar -->
    <div class="search-bar" id="searchBar">
        <input type="text" class="search-input" placeholder="Search notes..." id="searchInput">
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="no-notes">No notes yet. Create a new one!</div>
    </div>

    <!-- Editor Full Screen -->
    <div class="editor-full" id="editorFull">
        <textarea id="editorTextFull" class="editor-text-full" placeholder="Write your note here..."></textarea>
        <div class="popup-buttons" style="position: fixed; bottom: 70px; left: 0; width: 100%; padding: 10px; box-sizing: border-box; background: white; border-top: 1px solid #eee;">
            <button class="btn" onclick="saveNote()">Save</button>
            <button class="btn cancel-btn" onclick="closeEditor()">Cancel</button>
        </div>
    </div>

    <!-- New Tab Button -->
    <div class="new-tab-btn" onclick="createNewNote()">
        <img src="https://i.postimg.cc/wxRxpRTJ/1758009430835.png" alt="New Tab" class="new-tab-icon">
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-icon" onclick="goHome()">
            <img src="https://i.postimg.cc/ZKQLy3FH/1758009490013.png" alt="Home">
            <div class="nav-label">Home</div>
        </div>
        <div class="nav-icon" onclick="openInvite()">
            <img src="https://i.postimg.cc/rsNdR41F/share-icon-on-transparent-background-free-png.png" alt="Share">
            <div class="nav-label">Share</div>
        </div>
        <div class="nav-icon" onclick="openSettings()">
            <img src="https://i.postimg.cc/YjBqJdB8/1758009478805.png" alt="Settings">
            <div class="nav-label">Settings</div>
        </div>
    </div>

    <!-- Invite Popup -->
    <div id="invitePopup" class="popup">
        <div class="popup-content">
            <h3>You can invite your friends using link</h3>
            <p>and in the future you will get your personal referral code in the Invite section.</p>
            <p>Once available you will be able to share your code and earn ‚Çπ rewards directly into your wallet for every successful referral.</p>
            <p>Start inviting now and get ready to earn soon.</p>
            <p>https://jokefitabs.vercel.app/</p>
            <button class="btn" id="copyBtn">Copy Link</button>
            <div class="share-icons">
                <img src="https://i.postimg.cc/Gm4Zftw2/1758012881988.png" alt="Facebook" class="share-icon">
                <img src="https://i.postimg.cc/br2y8T4G/1758012910289.png" alt="WhatsApp" class="share-icon">
                <img src="https://i.postimg.cc/LXg56216/1758012926671.png" alt="X" class="share-icon">
                <img src="https://i.postimg.cc/8C8hVK3v/1758012946979.png" alt="Instagram" class="share-icon">
                <img src="https://i.postimg.cc/8C8hVK3v/1758012946979.png" alt="Telegram" class="share-icon">
            </div>
        </div>
    </div>

    <!-- About Popup -->
    <div id="aboutPopup" class="popup">
        <div class="popup-content">
            <h3>About JokeFi Notes</h3>
            <p>JokeFi Notes is the best app designed for everyone who wants to save their personal files, stories, important data, or any kind of notes securely and easily without any delay.</p>
            <p>Unlike other apps that sell your data for profit, JokeFi Notes ensures your privacy is fully protected and your information stays safe forever.</p>
            <p>Whether it‚Äôs a personal diary, important documents, creative stories, or simple daily notes ‚Äì you can save everything instantly in just a few taps.</p>
            <p>Our advanced system keeps your data secure and private at all times, giving you full control.</p>
            <p>Say goodbye to fear of data misuse and hello to a reliable solution where your files are yours alone.</p>
            <p>JokeFi Notes is made for those who value privacy, security, and speed the perfect choice for anyone who wants their notes safe forever without worrying about hidden fees or data leaks.</p>
            <p>Experience the future of note-saving apps today with JokeFi Notes safe simple and always yours.</p>
            <button class="btn" onclick="closeAbout()">Close</button>
        </div>
    </div>

    <!-- Clear All Data Alert Popup -->
    <div id="clearDataPopup" class="popup">
        <div class="popup-content">
            <img src="https://i.postimg.cc/xC8fqtDj/1758012015965.png" alt="Alert" class="alert-icon">
            <p>If you confirm now all your saved notes files will be permanently deleted from the system.</p>
            <p>This action cannot be undone and you will lose all your data forever.</p>
            <p>Please make sure you have backed up any important information before proceeding.</p>
            <div class="popup-buttons">
                <button class="btn confirm-btn">Confirm</button>
                <button class="btn cancel-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Settings Menu -->
    <div id="settingsMenu" class="settings-menu">
        <div class="settings-item" onclick="showAboutPopup()">
            <img src="https://i.postimg.cc/W1z2b5M9/1758011685776.png" alt="About">
            <span>About</span>
        </div>
        <div class="settings-item" onclick="showClearDataPopup()">
            <img src="https://i.postimg.cc/T1N4kJpw/1758011671773.png" alt="Clear All Data">
            <span>Clear All Data</span>
        </div>
    </div>

    <!-- Onboarding Guide Placeholder -->
    <div id="onboarding" class="onboarding">
        <button class="skip-btn">Skip</button>
        <!-- Guide steps with lines/arrows would need JS/CSS for positioning -->
        <div class="guide-step" style="top: 10px; left: 10px;">
            <p>Menu: Access settings and more</p>
            <div style="width: 50px; height: 2px; background: red; transform: rotate(45deg); margin-top: 5px;"></div>
        </div>
        <!-- Add more steps for other elements -->
    </div>

    <script>
        let notes = JSON.parse(localStorage.getItem('notes')) || [];
        let deletedNotes = JSON.parse(localStorage.getItem('deletedNotes')) || [];
        let currentEditingId = null;
        let notificationIntervals = {}; // To store intervals for each note
        const url = 'https://jokefitabs.vercel.app/';
        const longText = `I use JokeFi Notes to securely save my personal data, important files, and private stories. 

It feels extremely safe because my information stays fully protected and private Unlike other apps, JokeFi Notes never sells your data and keeps everything encrypted, giving me peace of mind.

It‚Äôs the perfect app to store important notes fast and securely, knowing my data is safe and always accessible only to me.

${url}`;
        const shortText = `Loving JokeFi Notes for secure, private note saving! No data selling, full encryption. Perfect for personal files & stories. ${url}`;

        // Notification setup
        if ('Notification' in window) {
            Notification.requestPermission();
        }

        function showNotification(title, body) {
            if (Notification.permission === 'granted') {
                new Notification(title, { body });
            }
        }

        function startNoteNotifications(id) {
            const interval = setInterval(() => {
                const note = notes.find(n => n.id === id);
                if (note && note.notification) {
                    showNotification('Note Reminder', `Don't forget: ${note.title}`);
                } else {
                    clearInterval(interval);
                }
            }, 5 * 60 * 1000); // 5 minutes
            notificationIntervals[id] = interval;
        }

        function stopNoteNotifications(id) {
            if (notificationIntervals[id]) {
                clearInterval(notificationIntervals[id]);
                delete notificationIntervals[id];
            }
        }

        function renderNotes(filter = '') {
            const mainContent = document.getElementById('mainContent');
            const searchTerm = filter.toLowerCase();
            let filteredNotes = notes.filter(note => note.title.toLowerCase().includes(searchTerm));

            if (filteredNotes.length === 0) {
                mainContent.innerHTML = '<div class="no-notes">No notes yet. Create a new one!</div>';
                return;
            }

            mainContent.innerHTML = filteredNotes.map(note => `
                <div class="note-file" onclick="openEditor('${note.id}')">
                    <span class="note-title">${note.title}</span>
                    <div class="note-actions">
                        <img src="https://i.postimg.cc/L8GKvNLb/1758010335631.png" alt="Edit" class="edit-icon" onclick="editTitle(event, '${note.id}'); event.stopPropagation();">
                        <img src="${note.notification ? 'https://i.postimg.cc/xT7dmGx6/1758009449096.png' : 'https://i.postimg.cc/XYFz838T/1758009466327.png'}" alt="Notification" class="notification-icon" onclick="toggleNotification(event, '${note.id}'); event.stopPropagation();">
                        <button class="delete-btn" onclick="deleteNote(event, '${note.id}'); event.stopPropagation();">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function renderTrash() {
            const trashContent = document.getElementById('trashContent');
            if (deletedNotes.length === 0) {
                trashContent.innerHTML = '<div class="no-deleted">No deleted notes.</div>';
                return;
            }
            trashContent.innerHTML = deletedNotes.map(note => `
                <div class="deleted-note">
                    <span class="note-title">${note.title}</span>
                    <div class="deleted-actions">
                        <button class="btn" onclick="restoreNote('${note.id}')">Restore</button>
                        <button class="btn confirm-btn" onclick="permanentDelete('${note.id}')">Delete Forever</button>
                    </div>
                </div>
            `).join('');
        }

        function createNewNote() {
            const id = Date.now().toString();
            const newNote = { id, title: 'New Note', content: '', notification: false };
            notes.unshift(newNote);
            saveNotes();
            openEditor(id);
        }

        function openEditor(id) {
            currentEditingId = id;
            const note = notes.find(n => n.id === id);
            if (note) {
                document.getElementById('editorTitle').value = note.title;
                document.getElementById('editorTextFull').value = note.content;
                document.getElementById('searchBar').style.display = 'none';
                document.getElementById('titleBar').style.display = 'block';
                document.getElementById('mainContent').style.display = 'none';
                document.getElementById('editorFull').classList.add('active');
                document.getElementById('app-name-bar').style.display = 'none';
            }
        }

        function editTitle(event, id) {
            event.stopPropagation();
            const newTitle = prompt('Enter new title:', notes.find(n => n.id === id).title);
            if (newTitle && newTitle.trim()) {
                const note = notes.find(n => n.id === id);
                note.title = newTitle.trim();
                saveNotes();
                renderNotes(document.getElementById('searchInput').value);
            }
        }

        function toggleNotification(event, id) {
            event.stopPropagation();
            const note = notes.find(n => n.id === id);
            note.notification = !note.notification;
            if (note.notification) {
                showNotification('Notification Enabled', 'Successful notification on for ' + note.title);
                startNoteNotifications(id);
            } else {
                stopNoteNotifications(id);
            }
            saveNotes();
            renderNotes(document.getElementById('searchInput').value);
        }

        function deleteNote(event, id) {
            event.stopPropagation();
            const noteIndex = notes.findIndex(n => n.id === id);
            if (noteIndex !== -1) {
                const note = notes[noteIndex];
                stopNoteNotifications(id);
                deletedNotes.unshift(notes.splice(noteIndex, 1)[0]);
                saveNotes();
                saveDeletedNotes();
                renderNotes(document.getElementById('searchInput').value);
            }
        }

        function restoreNote(id) {
            const delIndex = deletedNotes.findIndex(n => n.id === id);
            if (delIndex !== -1) {
                const note = deletedNotes[delIndex];
                notes.unshift(deletedNotes.splice(delIndex, 1)[0]);
                if (note.notification) {
                    startNoteNotifications(id);
                }
                saveNotes();
                saveDeletedNotes();
                renderTrash();
            }
        }

        function permanentDelete(id) {
            const delIndex = deletedNotes.findIndex(n => n.id === id);
            if (delIndex !== -1) {
                stopNoteNotifications(id);
                deletedNotes.splice(delIndex, 1);
                saveDeletedNotes();
                renderTrash();
            }
        }

        function saveNote() {
            const title = document.getElementById('editorTitle').value.trim();
            const content = document.getElementById('editorTextFull').value;
            if (title && currentEditingId) {
                const note = notes.find(n => n.id === currentEditingId);
                if (note) {
                    note.title = title;
                    note.content = content;
                    saveNotes();
                    renderNotes(document.getElementById('searchInput').value);
                }
            } else {
                alert('Please enter a title.');
            }
            closeEditor();
        }

        function closeEditor() {
            document.getElementById('searchBar').style.display = 'block';
            document.getElementById('titleBar').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('editorFull').classList.remove('active');
            document.getElementById('app-name-bar').style.display = 'block';
            currentEditingId = null;
        }

        function saveNotes() {
            localStorage.setItem('notes', JSON.stringify(notes));
        }

        function saveDeletedNotes() {
            localStorage.setItem('deletedNotes', JSON.stringify(deletedNotes));
        }

        function goHome() {
            renderNotes();
            closeEditor();
            closeSidebar();
            document.getElementById('invitePopup').style.display = 'none';
            document.getElementById('settingsMenu').style.display = 'none';
        }

        function openInvite() {
            document.getElementById('invitePopup').style.display = 'flex';
        }

        function openSettings() {
            document.getElementById('settingsMenu').style.display = 'block';
        }

        function openSidebar() {
            document.getElementById('sidebar').classList.add('open');
            document.getElementById('overlay').classList.add('open');
            renderTrash();
        }

        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('overlay').classList.remove('open');
        }

        // Event listeners
        document.querySelector('.nav-icon:nth-child(2)').addEventListener('click', openInvite);
        document.querySelector('.nav-icon:nth-child(3)').addEventListener('click', openSettings);
        document.getElementById('copyBtn').addEventListener('click', () => {
            navigator.clipboard.writeText(url).then(() => {
                alert('Link copied to clipboard!');
            });
        });

        // Share icons
        document.querySelectorAll('.share-icon').forEach(icon => {
            icon.addEventListener('click', () => {
                const alt = icon.alt;
                let shareUrl = '';
                let text = '';
                if (alt === 'X') {
                    text = shortText;
                    shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
                } else if (alt === 'Facebook') {
                    text = longText;
                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}&quote=${encodeURIComponent(text.replace(url, ''))}`;
                } else if (alt === 'WhatsApp') {
                    text = longText;
                    shareUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`;
                } else if (alt === 'Telegram') {
                    text = longText;
                    shareUrl = `https://t.me/share/url?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
                } else if (alt === 'Instagram') {
                    text = longText;
                    if (navigator.share) {
                        navigator.share({title: 'JokeFi Notes', text: text});
                    } else {
                        alert('Open Instagram and share:\n' + text);
                        window.open('https://www.instagram.com/', '_blank');
                    }
                    return;
                }
                window.open(shareUrl, '_blank');
            });
        });

        document.querySelector('.cancel-btn').addEventListener('click', () => {
            document.getElementById('clearDataPopup').style.display = 'none';
        });
        function showClearDataPopup() {
            document.getElementById('clearDataPopup').style.display = 'flex';
            document.getElementById('settingsMenu').style.display = 'none';
        }
        document.querySelector('.confirm-btn').addEventListener('click', () => {
            // Clear intervals
            Object.keys(notificationIntervals).forEach(id => clearInterval(notificationIntervals[id]));
            notificationIntervals = {};
            notes = [];
            deletedNotes = [];
            saveNotes();
            saveDeletedNotes();
            renderNotes();
            document.getElementById('clearDataPopup').style.display = 'none';
        });
        function showAboutPopup() {
            document.getElementById('aboutPopup').style.display = 'flex';
            document.getElementById('settingsMenu').style.display = 'none';
        }
        function closeAbout() {
            document.getElementById('aboutPopup').style.display = 'none';
        }
        // Close popups on outside click
        document.querySelectorAll('.popup').forEach(popup => {
            popup.addEventListener('click', (e) => {
                if (e.target === popup) popup.style.display = 'none';
            });
        });
        // Search
        document.getElementById('searchInput').addEventListener('input', (e) => {
            renderNotes(e.target.value);
        });
        // Initial render and restore notifications
        renderNotes();
        notes.forEach(note => {
            if (note.notification) {
                startNoteNotifications(note.id);
            }
        });
    </script>
</body>
</html>
